<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>zhangtaihao/hosting_subsite @ GitHub</title>
	
	<link rel="stylesheet" type="text/css" href="style.css" />
	
</head>

<body>
  <a href="http://github.com/zhangtaihao/hosting_subsite"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>

  <div id="container">

    <div class="download">
      <a href="http://github.com/zhangtaihao/hosting_subsite/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/zhangtaihao/hosting_subsite/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>

    <h1><a href="http://github.com/zhangtaihao/hosting_subsite">Aegir hosted subsite</a></h1>

    <div class="description">
      Hostmaster-managed Drupal sites hosted under subfolders.
    </div>

    <p>This module plugs into the hosting module under hostmaster install profile for the Drupal provisioning system Aegir. The module aims to address issues raised in:</p>

    <ul><li><a href="http://groups.drupal.org/node/19006">http://groups.drupal.org/node/19006</a></li></ul>

    <p>The mechanisms in this module are relatively naive. The module takes advantage of the existing Aegir architecture and does not alter the basic behaviour of the Site feature (nor can it). Instead, it does three things:</p>

    <ul>
      <li>Adds subsite management to the site edit form.</li>
      <li>Hook onto <code>provision_apache_vhost_config</code> to add an Apache alias and database connection parameters to the parent vhost for the subsite.</li>
      <li>Fire hosting tasks when subsite relationship changes occur.</li>
    </ul>

    <p>The subsite management mentioned above is merely a means for pairing sites with paths. As far as the module is concerned, it does not realise the pattern of the subsite's domain name other than assume that the user has named the site in such a way that Drupal loads the settings.php of that site correctly. An example situation demonstrate a potential limit to this mechanism is <code>www.example.com/au</code> being the same as <code>www.example.com.au</code> due to the way Drupal searches the sites folder for settings. As Aegir prevents the creation of two sites with identical domain names, it is impossible to even host the two variants on separate platforms.</p>

    <p>This module is currently being developed on Aegir 0.4-alpha7. Presumably, it will work on any Aegir 0.4 release, although this claim has not been tested. Support for Aegir 0.3 is not confirmed, although the more adventurous may wish to try.</p>
    
    <h4>UPDATE 2010-08-02</h4>
    <p>Aegir manages rewrite rules in platforms. Well, when I say &ldquo;manages&rdquo;, it actually imports the entire <code>.htaccess</code> file into the platform configuration. And then, it sticks <code>AllowOverride none</code> at the end.</p>
    <p>Since platforms already manages directory configuration, all I need for this module to do is turn rewrite rules in the directory back on (i.e. within <code>.htaccess</code>) by using <code>AllowOverride FileInfo</code>. This should be sufficient for now.</p>
    <p>Note that I haven't even bothered to import Aegir's custom config from modules. If we're speccing aliases to the same directory, we can't do a <code>RewriteBase</code>, and as of Aegir 0.4-alpha8 (even HEAD) those rewrites outputs start with a slash (which shouln't be there). So, shorthand file access is out, for the moment, at least until I decide symbolic links are better or Aegir no longer rewrites to root.</p>
    <p>I hope the Aegir folks get wind of this and decide to roll in this proof of concept (essentially). That way we don't need to rely on workarounds that may not work on exotic Drupal platforms.</p>

<h2>Dependencies</h2>
<p>Aegir 0.4</p>
<h2>Install</h2>
<p>Deploy module under the <code>sites/all/modules</code> directory inside the Hostmaster installation.</p>
<h2>License</h2>
<p>GPLv2</p>
<h2>Authors</h2>
<p>Taihao (Jason) Zhang - zhang.taihao (at) gmail (dot) com</p>

    <h2>Download</h2>
    <p>
      You can download this project in either
      <a href="http://github.com/zhangtaihao/hosting_subsite/zipball/master">zip</a> or
      <a href="http://github.com/zhangtaihao/hosting_subsite/tarball/master">tar</a> formats.
    </p>
    <p>You can also clone the project with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>$ git clone git://github.com/zhangtaihao/hosting_subsite</pre>
    </p>

    <div class="footer">
      get the source code on GitHub : <a href="http://github.com/zhangtaihao/hosting_subsite">zhangtaihao/hosting_subsite</a>
    </div>

  </div>

  
</body>
</html>
